<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pixeldrain Bypass üê±</title>

    <!-- Tailwind & fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            fontFamily: {
              jakarta: ['"Plus Jakarta Sans"', "ui-sans-serif", "system-ui"],
            },
          },
        },
      };
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <script defer src="https://unpkg.com/lucide@latest"></script>
    <meta name="google-site-verification" content="BdqJgi4Aa0xZFULeuyrX6XsaCLWMuMT86ITQxQbUGyM" />
    <meta name="description" content="Bypass Pixeldrain restrictions and download files or lists directly. Fast, secure, and ad-free Pixeldrain link bypasser." />
    <meta name="keywords" content="Pixeldrain, Bypass, Download, Direct Link, File Downloader, Pixeldrain List" />
    <meta name="author" content="Tuan Kuchiing" />
  </head>

  <body class="font-jakarta antialiased bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-100 min-h-screen">
    <div class="min-h-screen flex flex-col items-center px-4">
      <button
        id="themeToggle"
        class="fixed top-4 right-4 rounded-full p-2 ring-1 ring-gray-300/70 dark:ring-gray-700/70 bg-white/70 dark:bg-gray-800/70 hover:bg-gray-100 dark:hover:bg-gray-800 transition"
        title="Toggle theme"
        aria-label="Toggle dark mode"
      >
        <i data-lucide="moon" class="h-5 w-5"></i>
      </button>

      <main class="w-full max-w-2xl py-16">
        <h1 class="text-3xl font-extrabold text-center mb-4">Pixeldrain Link Bypass</h1>
        <p class="text-center mb-6">Full speed download with no limit on the amount of data</p>
        <div class="rounded-2xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 shadow-sm p-6 space-y-4">
          <label for="linkInput" class="text-sm font-medium">Paste your Pixeldrain links</label>
          <textarea
            id="linkInput"
            placeholder="One link per line..."
            class="w-full min-h-[140px] resize-y rounded-xl border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-900 px-4 py-3 outline-none focus:ring-2 focus:ring-sky-500"
            spellcheck="false"
            aria-label="Pixeldrain links"
          ></textarea>

          <!-- 3-button toolbar: Paste ‚Ä¢ Bypass (center) ‚Ä¢ Clear -->
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 items-center">
            <button
              id="pasteBtn"
              type="button"
              class="flex items-center justify-center gap-2 w-full rounded-xl ring-1 ring-gray-300 dark:ring-gray-700 bg-white dark:bg-gray-800 px-4 py-2.5 font-semibold hover:bg-gray-50 dark:hover:bg-gray-700 active:scale-[.99] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/60"
              title="Paste from clipboard"
              aria-label="Paste from clipboard"
            >
              <i data-lucide="clipboard-paste" class="h-5 w-5"></i>
              <span>Paste</span>
            </button>

            <button
              id="bypassBtn"
              type="button"
              class="flex items-center justify-center gap-2 w-full rounded-xl bg-sky-600 text-white px-4 py-2.5 font-semibold hover:bg-sky-700 active:scale-[.99] disabled:opacity-60 disabled:cursor-not-allowed focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/60"
              disabled
            >
              <svg id="spinner" class="hidden h-5 w-5 animate-spin" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
                <circle cx="12" cy="12" r="10" stroke-width="4" class="opacity-25" />
                <path d="M4 12a 8 8 0 0 1 8-8" stroke-width="4" class="opacity-75" />
              </svg>
              <span id="btnText">Bypass</span>
              <i data-lucide="arrow-right-circle" class="h-5 w-5"></i>
            </button>

            <button
              id="clearBtn"
              type="button"
              class="flex items-center justify-center gap-2 w-full rounded-xl ring-1 ring-gray-300 dark:ring-gray-700 bg-white dark:bg-gray-800 px-4 py-2.5 font-semibold hover:bg-gray-50 dark:hover:bg-gray-700 active:scale-[.99] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-sky-500/60"
              title="Clear input"
              aria-label="Clear input"
            >
              <i data-lucide="trash-2" class="h-5 w-5"></i>
              <span>Clear</span>
            </button>
          </div>

          <div id="messageBox" class="hidden mt-1 rounded-xl border px-4 py-3 text-sm" role="status" aria-live="polite"></div>
        </div>

        <section id="outputContainer" class="mt-6 hidden">
          <div id="bypassLink" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
        </section>
      </main>

      <footer class="mt-auto pb-10 text-center text-sm text-gray-500 dark:text-gray-400">
        Created with <span class="text-red-500">‚ù§</span> by
        <a href="https://web.facebook.com/kuchingneko" class="text-sky-600 hover:underline">Tuan Kuchiing üê±</a>
      </footer>
    </div>

    <script>
      const $ = (sel) => document.querySelector(sel);
      const escapeHTML = (str = "") => str.replace(/[&<>"]/g, (c) => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;" }[c]));

      function setMessage(kind, text) {
        const box = $("#messageBox");
        box.className = "mt-1 rounded-xl border px-4 py-3 text-sm";
        const base =
          kind === "success"
            ? "border-green-300 bg-green-50 text-green-800 dark:border-green-800/60 dark:bg-green-900/30 dark:text-green-200"
            : kind === "warning"
            ? "border-yellow-300 bg-yellow-50 text-yellow-800 dark:border-yellow-800/60 dark:bg-yellow-900/30 dark:text-yellow-200"
            : "border-red-300 bg-red-50 text-red-800 dark:border-red-800/60 dark:bg-red-900/30 dark:text-red-200";
        box.className += " " + base;
        box.textContent = text;
        box.classList.remove("hidden");
      }

      function toggleLoading(loading) {
        const btn = $("#bypassBtn");
        const spinner = $("#spinner");
        const text = $("#btnText");
        btn.disabled = !!loading || !$("#linkInput").value.trim();
        spinner.classList.toggle("hidden", !loading);
        text.textContent = loading ? "Working..." : "Bypass";
      }

      const savedTheme = localStorage.getItem("theme");
      if (savedTheme === "dark" || (!savedTheme && window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
        document.documentElement.classList.add("dark");
      }

      async function handlePaste() {
        try {
          if (!navigator.clipboard || !navigator.clipboard.readText) {
            setMessage("warning", "Clipboard API not available in this browser.");
            return;
          }
          const text = await navigator.clipboard.readText();
          if (!text) {
            setMessage("warning", "Clipboard is empty.");
            return;
          }
          const ta = $("#linkInput");
          // Append with newline if textarea already has content
          ta.value = ta.value ? ta.value.replace(/\s*$/, "\n") + text : text;
          // Trigger input listeners
          ta.dispatchEvent(new Event("input", { bubbles: true }));
          setMessage("success", "Pasted from clipboard.");
        } catch (e) {
          setMessage("error", `Couldn't paste: ${e.message}`);
        }
      }

      function handleClear() {
        $("#linkInput").value = "";
        toggleLoading(false);
      }

      async function handleBypass() {
        const raw = $("#linkInput").value.trim();
        const links = raw
          .split(/\r?\n/)
          .map((l) => l.trim())
          .filter(Boolean);
        const container = $("#outputContainer");
        const grid = $("#bypassLink");

        toggleLoading(true);
        container.classList.add("hidden");
        $("#messageBox").classList.add("hidden");
        grid.innerHTML = "";

        if (!links.length) {
          setMessage("warning", "Please enter at least one Pixeldrain link.");
          toggleLoading(false);
          return;
        }

        let success = 0;
        let failures = [];
        for (const url of links) {
          try {
            const res = await fetch("/", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ url }),
            });
            if (!res.ok) {
              failures.push(`HTTP ${res.status} for ${url}`);
              continue;
            }
            const result = await res.json();
            const viewer = result.viewerData;

            if (viewer?.type === "list" && Array.isArray(viewer.api_response?.files)) {
              const { files, title } = viewer.api_response;
              grid.insertAdjacentHTML("beforeend", `<div class=\"col-span-full\"><h2 class=\"mb-2 text-lg font-semibold\">${escapeHTML(title)}</h2></div>`);
              for (const file of files) addFileCard(file);
              success++;
            } else if (viewer?.type === "file" && viewer.api_response?.id) {
              addFileCard(viewer.api_response);
              success++;
            } else {
              failures.push(`Invalid data for ${url}`);
            }
          } catch (e) {
            failures.push(`Error processing ${url}: ${e.message}`);
          }
        }

        if (success) {
          setMessage("success", `Success. ${success} of ${links.length} processed.`);
          container.classList.remove("hidden");
          container.scrollIntoView({ behavior: "smooth" });
        } else {
          setMessage("error", failures[0] || "No valid files found. Please check your links.");
        }

        toggleLoading(false);
        lucide.createIcons();
      }

      function addFileCard(file) {
        const sizeMB = (file.size / 1024 / 1024).toFixed(2);
        const id = encodeURIComponent(file.id);
        const name = escapeHTML(file.name);
        const card = /* html */ `<article class=\"rounded-2xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-800 p-4 shadow-sm\">
          <h3 class=\"truncate font-semibold\" title=\"${name}\">${name}</h3>
          <p class=\"mt-1 text-xs text-gray-500 dark:text-gray-400\">${sizeMB} MB ‚Ä¢ ${file.views} views ‚Ä¢ ${file.downloads} downloads</p>
          <a class=\"mt-3 inline-flex items-center gap-1.5 rounded-lg bg-sky-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-sky-700\" href=\"https://pd.cybar.xyz/${id}\" target=\"_blank\" rel=\"noopener\">\n            <i data-lucide=\"download\" class=\"h-4 w-4\"></i>\n            Download\n          </a>\n        </article>`;
        $("#bypassLink").insertAdjacentHTML("beforeend", card);
      }

      window.addEventListener("DOMContentLoaded", () => {
        lucide.createIcons();
        $("#bypassBtn").addEventListener("click", handleBypass);
        $("#pasteBtn").addEventListener("click", handlePaste);
        $("#clearBtn").addEventListener("click", handleClear);
        $("#themeToggle").addEventListener("click", () => {
          document.documentElement.classList.toggle("dark");
          localStorage.setItem("theme", document.documentElement.classList.contains("dark") ? "dark" : "light");
        });
        $("#linkInput").addEventListener("input", () => toggleLoading(false));
        $("#linkInput").addEventListener("keydown", (e) => {
          if ((e.metaKey || e.ctrlKey) && e.key === "Enter") {
            e.preventDefault();
            handleBypass();
          }
        });
      });
    </script>
  </body>
</html>
